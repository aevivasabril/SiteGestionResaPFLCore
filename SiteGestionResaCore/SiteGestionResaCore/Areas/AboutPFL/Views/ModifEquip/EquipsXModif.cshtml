@model EquipsXModifVM
@{
    ViewBag.Title = "ModifierInfosEquipements";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<br />
<h5 class="text-center">Liste des équipements pour la zone @Model.NomZone </h5>
<h6 class="text-center">Plusieurs actions sont possibles par équipement</h6>
<br />

@Html.ValidationSummary(false, "", new { @class = "text-danger" })
@for (int i = 0; i < Model.ListeEquipements.Count(); i++)
{
    <div class="card">
        <h5 class="card-header">
            <strong>@Model.ListeEquipements[i].NomEquipement (Num GMAO: @Model.ListeEquipements[i].NumGmaoEquipement)</strong>
        </h5>
        <div class="card-body">
            @if (Model.ListeEquipements[i].FicheMaterielDispo == true)
            {
                <p class="card-text"><strong>Nom Document: </strong>@Model.ListeEquipements[i].NomFicheMat</p>
                <p class="card-text"><strong>Date dernière modification: </strong>@Model.ListeEquipements[i].DateModif</p>
                <a class="btn btn-secondary text-center" asp-action="SupprimerFiche" asp-controller="ModifEquip" asp-area="AboutPFL" asp-route-id="@Model.ListeEquipements[i].IdFicheMat">Supprimer Fiche Materiel</a>
                <a class="btn btn-secondary text-center" asp-action="ModifierFiche" asp-controller="ModifEquip" asp-area="AboutPFL" asp-route-id="@Model.ListeEquipements[i].IdFicheMat">Modifier Fiche Materiel</a>
            }
            else
            {
                <a class="btn btn-secondary" asp-action="Ajouterfiche" asp-controller="ModifEquip" asp-area="AboutPFL" asp-route-id="@Model.ListeEquipements[i].IdEquipement">Ajouter Fiche Materiel</a>
            }

            <a class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Supprimer équipement" asp-action="SupprimerEquip" asp-area="AboutPFL" asp-controller="ModifEquip" asp-route-id="@Model.ListeEquipements[i].IdEquipement">
                <span class="fas fa-trash"></span>
            </a>
        
        </div>
    </div>
    <br />
}
<br />
<div class="row justify-content-center">
    <a asp-action="GestionEquipements" asp-controller="ModifEquip" asp-area="AboutPFL">Revenir à la page précedente</a>
</div>


<form asp-area="AboutPFL" asp-controller="ModifEquip" asp-action="ValidAjoutFiche" asp-route-id="@Model.IdEquipement" method="post" enctype="multipart/form-data"> 
    <!-- Modal pop-up pour ajout d'un nouveau document AQ-->
    <div class="modal fade" id="AddFicheMat" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModal" aria-hidden="true">
        <div class="modal-dialog navbar-inra" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-center" id="staticBackdropLabel">Ajout d'une fiche materiel</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modalcontent">
                    @if (ViewBag.AfficherMessage == true)
                    {
                        <p class="text-center" style="color:red">@ViewBag.MessagePopUp</p>
                    }
                    <p>Sélectionnez un fichier local (uniquement format PDF)</p>
                    <div class="form-row">
                        <input type="file" name="file" required />
                    </div>
                    <br />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Ignorer</button>
                    <input type="submit" class="btn btn-primary" value="Ajouter document" />
                </div>
            </div>
        </div>
    </div>
</form>

<form asp-action="ConfSuppFiche" asp-controller="ModifEquip" asp-route-id="@Model.IdDoc" asp-area="AboutPFL" method="post">
    <!-- Modal pop-up d'info-->
    <div class="modal fade" id="suppFiche" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModal" aria-hidden="true">
        <div class="modal-dialog navbar-inra" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Suppression Fiche Materiel</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modalcontent">
                    <p class="font-weight-bold text-center">
                        Après confirmation, la fiche materiel sera supprimée <strong>DEFINITIVEMENT</strong>.
                        Cette opération est irreversible. On y va?
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="submit" class="btn btn-secondary" data-dismiss="modal">Ignorer</button>
                    <input type="submit" class="btn btn-primary" value="Valider" />
                </div>
            </div>
        </div>
    </div>
</form>

<form asp-area="AboutPFL" asp-controller="ModifEquip" asp-action="ValidModifFiche" asp-route-id="@Model.IdFicheMat" method="post" enctype="multipart/form-data">
    <!-- Modal pop-up pour ajout d'un nouveau document AQ-->
    <div class="modal fade" id="ModifFicheMat" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModal" aria-hidden="true">
        <div class="modal-dialog navbar-inra" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-center" id="staticBackdropLabel">Modification d'une fiche materiel</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modalcontent">
                    @if (ViewBag.AfficherMessage == true)
                    {
                        <p class="text-center" style="color:red">@ViewBag.MessagePopUp</p>
                    }
                    <p>Remplacez la fiche materiel actuelle par un autre fichier local (uniquement format PDF)</p>
                    <div class="form-row">
                        <input type="file" name="file" required />
                    </div>
                    <br />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Ignorer</button>
                    <input type="submit" class="btn btn-primary" value="Remplacer fiche materiel" />
                </div>
            </div>
        </div>
    </div>
</form>

<form asp-area="AboutPFL" asp-controller="ModifEquip" asp-action="ConfNumGMAO" asp-route-id="@Model.IdEquipement" method="post" enctype="multipart/form-data">
    <!-- Modal pop-up pour ajout d'un nouveau document AQ-->
    <div class="modal fade" id="ModifNumGmao" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModal" aria-hidden="true">
        <div class="modal-dialog navbar-inra" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-center" id="staticBackdropLabel">Modification du numéro GMAO</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modalcontent">
                    @if (ViewBag.AfficherMessage == true)
                    {
                        <p class="text-center" style="color:red">@ViewBag.MessagePopUp</p>
                    }
                    <p>Nouveau numéro GMAO pour l'équipement</p>
                    <div class="form-group">
                        @Html.TextAreaFor(m => m.NumGmao, new { @class = "col-md-12 form-control" })
                        @Html.ValidationMessageFor(m => m.NumGmao, "", new { @class = "text-danger" })
                    </div>
                    <br />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Ignorer</button>
                    <input type="submit" class="btn btn-primary" value="Remplacer numéro GMAO" />
                </div>
            </div>
        </div>
    </div>
</form>

<form asp-action="ConfSuppEquip" asp-controller="ModifEquip" asp-route-id="@Model.IdEquipement" asp-area="AboutPFL" method="post">
    <!-- Modal pop-up d'info-->
    <div class="modal fade" id="suppEquip" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModal" aria-hidden="true">
        <div class="modal-dialog navbar-inra" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Suppression équipement</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modalcontent">
                    <p class="font-weight-bold text-center">
                        Confirmez-vous la suppression de cet équipement?
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="submit" class="btn btn-secondary" data-dismiss="modal">Ignorer</button>
                    <input type="submit" class="btn btn-primary" value="Valider" />
                </div>
            </div>
        </div>
    </div>
</form>

@section Scripts {
    @*script pour afficher le popoup de confirmation de demande *@
<script>
        @{
            if (ViewBag.ModalAddingFic == null)
            {
                ViewBag.ModalAddingFic = "hide";
            }
            if (ViewBag.ModalConfirSupp == null)
            {
                ViewBag.ModalConfirSupp = "hide";
            }
            if (ViewBag.ModalModifFiche == null)
            {
                ViewBag.ModalModifFiche = "hide";
            }
            if (ViewBag.ModifNumGmao == null)
            {
                ViewBag.ModifNumGmao = "hide";
            }
            if (ViewBag.ModalSuppEquip == null)
            {
                ViewBag.ModalSuppEquip = "hide";
            }
        }
        $('#AddFicheMat').modal('@ViewBag.ModalAddingFic');
        $('#suppFiche').modal('@ViewBag.ModalConfirSupp');
        $('#ModifFicheMat').modal('@ViewBag.ModalModifFiche');
        $('#ModifNumGmao').modal('@ViewBag.ModifNumGmao');
        $('#suppEquip').modal('@ViewBag.ModalSuppEquip');

</script>
}